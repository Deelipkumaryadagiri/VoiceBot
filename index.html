<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Deelip Kumar - AI Voice Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

<style>
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html, body {
    height: 100%;
    font-family: 'Poppins', sans-serif;
    background: #f3f4f6;
    overflow: hidden;
}

/* ============ LOADING SCREEN ============ */
#loadingScreen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: #f3f4f6;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease, visibility 0.5s ease;
}

#loadingScreen.hidden {
    opacity: 0;
    visibility: hidden;
}

#loadingScreen dotlottie-wc {
    width: 250px;
    height: 250px;
}

/* ============ MAIN APP ============ */
#appWrapper {
    width: 100%;
    height: 100vh;
    opacity: 0;
    transition: opacity 0.5s ease 0.1s;
}

#appWrapper.visible {
    opacity: 1;
}

/* Layout */
.app-container {
    display: flex;
    width: 100%;
    height: 100vh;
    overflow: hidden;
}

/* LEFT CHAT — 60% on desktop, 100% mobile */
.chat-section {
    width: 60%;
    display: flex;
    flex-direction: column;
    padding: 20px 30px;
    overflow: hidden;
}

/* RIGHT ANIMATION — 40% on desktop, hidden on mobile */
.voice-section {
    width: 40%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* Header */
.header h1 {
    font-size: 26px;
    color: #333;
}

.subtitle {
    color: #666;
    font-size: 14px;
}

/* Chat Area */
.chat-container {
    flex: 1;
    overflow-y: auto;
    background: #ffffff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    margin-bottom: 15px;
    min-height: 0; /* needed for flex child scrolling */
}

.message {
    max-width: 80%;
    padding: 12px 18px;
    border-radius: 16px;
    margin-bottom: 12px;
    font-size: 14px;
    line-height: 1.5;
}

.user-message {
    background: #667eea;
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 4px;
}

.bot-message {
    background: #f1f3f9;
    color: #333;
    margin-right: auto;
    border-bottom-left-radius: 4px;
}

/* Suggestions */
.sample-questions {
    background: #f9fafb;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
}

.sample-questions ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.sample-questions li {
    font-size: 13px;
    padding: 5px 10px;
    cursor: pointer;
    color: #667eea;
    border-radius: 5px;
    transition: background-color 0.2s;
}

.sample-questions li:hover {
    text-decoration: underline;
    background-color: #e0e7ff;
}

/* Input Area */
.input-area {
    display: flex;
    gap: 10px;
}

input {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 14px;
    min-width: 0;
}

button {
    border: none;
    padding: 12px 16px;
    border-radius: 8px;
    background: #d0d3e0;
    color: black;
    cursor: pointer;
    flex-shrink: 0;
}

button:hover {
    background: #777a8c;
}

/* Voice Lottie animations */
.voice-section dotlottie-wc {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0); }
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
    .app-container {
        flex-direction: column;
    }

    .chat-section {
        width: 100%;
        height: 100vh;
        padding: 15px;
    }

    .voice-section {
        display: none;
    }

    .chat-container {
        flex: 1;
        min-height: 0;
    }

    .sample-questions ul {
        gap: 6px;
    }

    .sample-questions li {
        font-size: 12px;
        padding: 4px 8px;
    }

    .input-area {
        gap: 6px;
    }

    input {
        font-size: 13px;
        padding: 10px;
    }

    button {
        padding: 10px 13px;
    }
}
</style>
</head>
<body>

<!-- LOADING SCREEN -->
<div id="loadingScreen">
    <dotlottie-wc
        src="https://lottie.host/ec20d7af-8a04-418e-a819-0663c57af468/Yp6scb4v40.lottie"
        autoplay
        loop
    ></dotlottie-wc>
</div>

<!-- MAIN APP -->
<div id="appWrapper">
<div class="app-container">

    <!-- LEFT CHAT -->
    <div class="chat-section">

        <div id="chatContainer" class="chat-container"></div>

        <div class="sample-questions">
            <ul>
                <li onclick="askQuestion('Tell me about yourself')">Tell me about yourself</li>
                <li onclick="askQuestion('What are your top skills?')">What are your top skills?</li>
                <li onclick="askQuestion('Explain your projects')">Explain your projects</li>
                <li onclick="askQuestion('What role are you looking for?')">What role are you looking for?</li>
            </ul>
        </div>

        <div class="input-area">
            <input type="text" id="textInput" placeholder="Type your message..." onkeydown="if(event.key==='Enter') sendTextMessage()" />
            <button onclick="sendTextMessage()"><i class="bi bi-send-fill"></i></button>
            <button onclick="toggleVoice()"><i class="bi bi-mic-fill"></i></button>
        </div>

    </div>

    <!-- RIGHT LOTTIE (Desktop Only) -->
    <div class="voice-section">
        <h1>Deelip Kumar</h1>
        <p class="subtitle">AI Voice Assistant — Ask about my background, projects & skills</p>

        <dotlottie-wc
            id="idleLottie"
            src="https://lottie.host/403855b6-628a-4b5e-9d7a-e9bef4d92c2d/JMOahEl22m.lottie"
            style="width: 600px; height: 500px;"
            autoplay
            loop
        ></dotlottie-wc>

        <dotlottie-wc
            id="listeningLottie"
            src="https://lottie.host/6b5449fe-9e65-433c-a377-8ac3d9e5b467/wNWRyoU8Ga.lottie"
            style="width: 300px; height: 150px; display: none;"
            autoplay
            loop
        ></dotlottie-wc>
    </div>

</div>
</div>

<script
  src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.8.11/dist/dotlottie-wc.js"
  type="module"
></script>

<script>
let isListening = false;
let recognition = null;
let idleLottie, listeningLottie;

window.addEventListener("load", function () {
    setTimeout(() => {
        document.getElementById("loadingScreen").classList.add("hidden");
        document.getElementById("appWrapper").classList.add("visible");
    }, 1200);
});

window.onload = function() {
    idleLottie = document.getElementById("idleLottie");
    listeningLottie = document.getElementById("listeningLottie");
    listeningLottie.style.display = "none";

    addMessage("Hello! I'm Deelip Kumar. You can type or use the mic to ask me about my skills, projects, and experience.", "bot");

    if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = "en-US";

        recognition.onresult = function (event) {
            const text = event.results[0][0].transcript;
            addMessage(text, "user");
            sendToBot(text);
        };

        recognition.onend = function () { stopListening(); };
    }
};

function toggleVoice() {
    if (!recognition) { alert("Voice not supported in this browser"); return; }
    isListening ? stopListening() : startListening();
}

function startListening() {
    isListening = true;
    recognition.start();
    idleLottie.style.display = "none";
    listeningLottie.style.display = "block";
}

function stopListening() {
    isListening = false;
    try { recognition.stop(); } catch(e) {}
    listeningLottie.style.display = "none";
    idleLottie.style.display = "block";
}

function sendTextMessage() {
    const input = document.getElementById("textInput");
    const msg = input.value.trim();
    if (!msg) return;
    addMessage(msg, "user");
    sendToBot(msg);
    input.value = "";
}

function askQuestion(q) {
    addMessage(q, "user");
    sendToBot(q);
}

function addMessage(text, sender) {
    const chat = document.getElementById("chatContainer");
    const div = document.createElement("div");
    div.className = "message " + (sender === "user" ? "user-message" : "bot-message");
    div.innerText = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

async function sendToBot(message) {
    try {
        const response = await fetch("https://voicebot-xyox.onrender.com/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });
        const data = await response.json();
        addMessage(data.response, "bot");
        speak(data.response);
    } catch (error) {
        addMessage("⚠️ Bot is not responding. Is your backend running?", "bot");
    }
}

function speak(text) {
    if (!window.speechSynthesis) return;
    const utter = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utter);
}
</script>

</body>
</html>
